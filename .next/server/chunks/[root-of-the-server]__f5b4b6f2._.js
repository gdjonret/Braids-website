module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},77324,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),s=e.i(61916),i=e.i(74677),o=e.i(69741),l=e.i(16795),u=e.i(87718),d=e.i(95169),c=e.i(47587),p=e.i(66012),h=e.i(70101),f=e.i(26937),v=e.i(10372),E=e.i(93695);e.i(52474);var R=e.i(220),y=e.i(89171);let m=process.env.SQUARE_ACCESS_TOKEN,x=process.env.SQUARE_LOCATION_ID,w=process.env.SQUARE_SERVICE_VARIATION_ID,A=process.env.SQUARE_TEAM_MEMBER_ID,_=process.env.SQUARE_TIMEZONE_OFFSET??"-04:00",g=process.env.CALENDLY_EVENT_SLUG??"30min",C=process.env.CALENDLY_TIMEZONE??"America/New_York";function T(){let e=process.env.CALENDLY_API_KEY;if(!e)throw Error("Missing CALENDLY_API_KEY");return e}let N=null,S=null;async function b(e){if(N)return N;let t=await fetch("https://api.calendly.com/users/me",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw Error(`Calendly users/me request failed: ${t.status}`);let r=await t.json(),a=r.resource?.uri;if(!a)throw Error("Calendly user URI missing in response");return N=a,a}async function $(e){if(S)return S;if(!g)throw Error("Missing Calendly event slug (set CALENDLY_EVENT_SLUG)");let t=await b(e),r=new URL("https://api.calendly.com/event_types");r.searchParams.set("user",t),r.searchParams.set("slug",g);let a=await fetch(r,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw Error(`Calendly event_types request failed: ${a.status}`);let n=await a.json(),s=n.collection?.[0]?.uri;if(!s)throw Error(`Calendly event type not found for slug "${g}"`);return S=s,s}async function O(e,t){let r=T(),a=await $(r),n=new URL("https://api.calendly.com/event_type_available_times");n.searchParams.set("event_type",a),n.searchParams.set("start_time",e),n.searchParams.set("end_time",t),C&&n.searchParams.set("timezone",C);let s=await fetch(n,{headers:{Authorization:`Bearer ${r}`}});if(!s.ok)throw Error(`Calendly availability request failed: ${s.status}`);let i=await s.json();return{slots:Array.isArray(i.collection)?i.collection.filter(e=>"string"==typeof e.start_time).map(e=>({startAt:e.start_time})):[],source:"calendly"}}function I(e){let t=e.slice(0,10),r=[];for(let e=9;e<=20;e++){let a=e.toString().padStart(2,"0");r.push({startAt:`${t}T${a}:00:00${_}`}),r.push({startAt:`${t}T${a}:30:00${_}`})}return r}async function P(e,t){if(!m||!x||!w)return{slots:I(e),source:"mock"};let r={service_variation_id:w};A&&(r.team_member_id_filter={any:[A]});let a=await fetch("https://connect.squareup.com/v2/appointments/availability",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({location_id:x,start_at:e,end_at:t,limit:100,segment_filters:[r]})});if(!a.ok){let e=await a.text();return y.NextResponse.json({error:"SQUARE_AVAILABILITY_ERROR",details:e},{status:a.status})}let n=await a.json();return{slots:Array.isArray(n.availabilities)?n.availabilities.map(t=>({startAt:"string"==typeof t.start_at?t.start_at:e})):[],source:"square"}}async function U(e){var t;let r,a,n,s,i,o,{searchParams:l}=new URL(e.url),{startAt:u,endAt:d,startUtc:c,endUtc:p,date:h}=(a=(r=(t=l.get("date")??void 0)?new Date(t):new Date).getFullYear(),n=`${r.getMonth()+1}`.padStart(2,"0"),s=`${r.getDate()}`.padStart(2,"0"),i=`${a}-${n}-${s}`,o=`${i}T00:00:00${_}`,{startAt:o,endAt:`${i}T23:59:59${_}`,startUtc:new Date(`${i}T00:00:00${_}`).toISOString(),endUtc:new Date(`${i}T23:59:59${_}`).toISOString(),date:i}),f=null;try{f=await O(c,p)}catch(e){console.warn("Calendly availability fallback",e)}if(!f||"slots"in f&&0===f.slots.length){let e=await P(u,d);if(e instanceof y.NextResponse)return e;f=e}return!f||f instanceof y.NextResponse?y.NextResponse.json({date:h,slots:I(u),source:"mock"}):y.NextResponse.json({date:h,slots:f.slots,source:f.source})}e.s(["GET",()=>U,"getCalendlyApiKey",()=>T],65108);var k=e.i(65108);let D=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/availability/route",pathname:"/api/availability",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/availability/route.ts",nextConfigOutput:"",userland:k}),{workAsyncStorage:j,workUnitAsyncStorage:q,serverHooks:L}=D;function M(){return(0,a.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:q})}async function H(e,t,a){D.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/availability/route";y=y.replace(/\/index$/,"")||"/";let m=await D.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!m)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:x,params:w,nextConfig:A,parsedUrl:_,isDraftMode:g,prerenderManifest:C,routerServerContext:T,isOnDemandRevalidate:N,revalidateOnlyGenerated:S,resolvedPathname:b,clientReferenceManifest:$,serverActionsManifest:O}=m,I=(0,o.normalizeAppPath)(y),P=!!(C.dynamicRoutes[I]||C.routes[b]),U=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,_,!1):t.end("This page could not be found"),null);if(P&&!g){let e=!!C.routes[b],t=C.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await U();throw new E.NoFallbackError}}let k=null;!P||D.isDev||g||(k="/index"===(k=b)?"/":k);let j=!0===D.isDev||!P,q=P&&!j;O&&$&&(0,i.setManifestsSingleton)({page:y,clientReferenceManifest:$,serverActionsManifest:O});let L=e.method||"GET",M=(0,s.getTracer)(),H=M.getActiveScopeSpan(),K={params:w,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>D.onRequestError(e,t,a,n,T)},sharedContext:{buildId:x}},B=new l.NodeNextRequest(e),F=new l.NodeNextResponse(t),Y=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let i=async e=>D.handle(Y,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${L} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${y}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let u=async({previousCacheEntry:r})=>{try{if(!o&&N&&S&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await i(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=K.renderOpts.collectedTags;if(!P)return await (0,p.sendResponse)(B,F,s,K.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);u&&(t[v.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,a=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await D.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:N})},!1,T),t}},d=await D.handleResponse({req:e,nextConfig:A,cacheKey:k,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:S,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:o});if(!P)return null;if((null==d||null==(s=d.value)?void 0:s.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",N?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),g&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let E=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&P||E.delete(v.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||E.get("Cache-Control")||E.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(B,F,new Response(d.value.body,{headers:E,status:d.value.status||200})),null};H?await l(H):await M.withPropagatedContext(e.headers,()=>M.trace(d.BaseServerSpan.handleRequest,{spanName:`${L} ${y}`,kind:s.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof E.NoFallbackError||await D.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:N})},!1,T),P)throw t;return await (0,p.sendResponse)(B,F,new Response(null,{status:500})),null}}e.s(["handler",()=>H,"patchFetch",()=>M,"routeModule",()=>D,"serverHooks",()=>L,"workAsyncStorage",()=>j,"workUnitAsyncStorage",()=>q],77324)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f5b4b6f2._.js.map